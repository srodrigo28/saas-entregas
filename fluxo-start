# API de Entregas como ServiÃ§o (Delivery as a Service)

Este documento descreve um **passo a passo conceitual**, sem cÃ³digo, para ajudar vocÃª a **refletir e planejar** uma API de entregas voltada ao cenÃ¡rio brasileiro. Inclui **entidades (tabelas)**, **fluxos**, **perfis**, **status**, e **integraÃ§Ãµes externas**.

---

## 1) VisÃ£o Geral do Produto

**Objetivo**: oferecer um serviÃ§o de logÃ­stica urbana via API para:

* Seu prÃ³prio app (estilo iFood)
* Estabelecimentos (farmÃ¡cias, restaurantes, mercados)
* Terceiros (e-commerces regionais)

**Modelo**: B2B / SaaS (por entrega, por plano mensal, ou hÃ­brido).

---

## 2) Perfis e PapÃ©is (Quem usa o sistema)

### Perfis principais

* **Admin da Plataforma**: configura regras, preÃ§os, integraÃ§Ãµes.
* **Estabelecimento (Cliente B2B)**: cria pedidos, acompanha entregas.
* **Entregador (Motorista/Motoboy)**: aceita e executa entregas.
* **Sistema Integrado (API Client)**: apps e ERPs terceiros.

---

## 3) Entidades Principais (Resumo de Tabelas)

### 3.1 Estabelecimentos

| Campo                | DescriÃ§Ã£o                      |
| -------------------- | ------------------------------ |
| id                   | Identificador Ãºnico            |
| nome_fantasia        | Nome pÃºblico                   |
| razao_social         | RazÃ£o social                   |
| cnpj                 | Documento                      |
| endereco_base        | Ponto de coleta                |
| latitude / longitude | GeolocalizaÃ§Ã£o                 |
| tipo                 | Restaurante, FarmÃ¡cia, Mercado |
| plano                | Free, Pro, Enterprise          |
| status               | Ativo, Suspenso                |

---

### 3.2 UsuÃ¡rios do Estabelecimento

| Campo              | DescriÃ§Ã£o       |
| ------------------ | --------------- |
| id                 | Identificador   |
| estabelecimento_id | VÃ­nculo         |
| nome               | Nome            |
| email              | Login           |
| perfil             | Admin, Operador |
| status             | Ativo/Inativo   |

---

### 3.3 Entregadores

| Campo      | DescriÃ§Ã£o         |
| ---------- | ----------------- |
| id         | Identificador     |
| nome       | Nome              |
| cpf        | Documento         |
| telefone   | Contato           |
| tipo       | PrÃ³prio, Parceiro |
| status     | Ativo, Bloqueado  |
| disponivel | Sim/NÃ£o           |
| nota_media | AvaliaÃ§Ã£o         |

---

### 3.4 VeÃ­culos

| Campo         | DescriÃ§Ã£o         |
| ------------- | ----------------- |
| id            | Identificador     |
| entregador_id | Dono              |
| tipo          | Moto, Bike, Carro |
| placa         | IdentificaÃ§Ã£o     |
| capacidade    | Peso/volume       |
| status        | Ativo             |

---

### 3.5 EndereÃ§os

| Campo                | DescriÃ§Ã£o       |
| -------------------- | --------------- |
| id                   | Identificador   |
| tipo                 | Coleta, Entrega |
| logradouro           | Rua             |
| numero               | NÃºmero          |
| complemento          | Opcional        |
| bairro               | Bairro          |
| cidade               | Cidade          |
| estado               | UF              |
| latitude / longitude | GeolocalizaÃ§Ã£o  |

---

## 4) Entidade Central: Entrega

### 4.1 Entregas

| Campo               | DescriÃ§Ã£o        |
| ------------------- | ---------------- |
| id                  | Identificador    |
| estabelecimento_id  | Origem           |
| entregador_id       | Alocado          |
| endereco_coleta_id  | Coleta           |
| endereco_entrega_id | Destino          |
| distancia_km        | Calculada        |
| valor               | PreÃ§o da entrega |
| status              | Fluxo da entrega |
| tipo_servico        | PrÃ³prio, Externo |
| previsao_entrega    | ETA              |

---

### 4.2 Status de Entrega (Fluxo)

| Status              | DescriÃ§Ã£o          |
| ------------------- | ------------------ |
| CRIADA              | Pedido criado      |
| PRECIFICADA         | Valor calculado    |
| BUSCANDO_ENTREGADOR | Match em andamento |
| ACEITA              | Entregador aceitou |
| COLETADA            | Pedido coletado    |
| EM_ROTA             | Em deslocamento    |
| ENTREGUE            | Finalizada         |
| CANCELADA           | Cancelada          |

---

### 4.3 HistÃ³rico de Status

| Campo      | DescriÃ§Ã£o                            |
| ---------- | ------------------------------------ |
| id         | Identificador                        |
| entrega_id | VÃ­nculo                              |
| status     | Status                               |
| data_hora  | Timestamp                            |
| origem     | Sistema, Entregador, Estabelecimento |

---

## 5) PrecificaÃ§Ã£o

### 5.1 Regras de PreÃ§o

| Campo             | DescriÃ§Ã£o     |
| ----------------- | ------------- |
| id                | Identificador |
| taxa_base         | Valor fixo    |
| valor_km          | PreÃ§o por km  |
| adicional_noturno | Extra         |
| adicional_chuva   | Extra         |
| tipo_veiculo      | Moto, Bike    |
| cidade            | Escopo        |

---

### 5.2 SimulaÃ§Ã£o de PreÃ§o

* DistÃ¢ncia (km)
* Tipo de veÃ­culo
* HorÃ¡rio
* Regras ativas

Resultado: **valor_estimado**

---

## 6) Matching (Pedido â†” Entregador)

### CritÃ©rios iniciais (simples)

* Disponibilidade
* Proximidade
* Tipo de veÃ­culo

### EvoluÃ§Ã£o futura

* AvaliaÃ§Ã£o
* Tempo ocioso
* HistÃ³rico de cancelamentos

---

## 7) IntegraÃ§Ãµes Externas (APIs de Entrega)

### 7.1 Tabela de IntegraÃ§Ãµes

| Campo      | DescriÃ§Ã£o          |
| ---------- | ------------------ |
| id         | Identificador      |
| nome       | Uber Direct, Loggi |
| tipo       | Delivery           |
| ativo      | Sim/NÃ£o            |
| prioridade | Ordem de uso       |

---

### 7.2 Entregas Externas

| Campo          | DescriÃ§Ã£o     |
| -------------- | ------------- |
| id             | Identificador |
| entrega_id     | Interna       |
| integracao_id  | API usada     |
| external_id    | ID externo    |
| status_externo | Status API    |
| custo          | Custo real    |

---

### EstratÃ©gia de uso

1. Tentar entregador prÃ³prio
2. Se falhar â†’ API externa
3. Registrar tudo no histÃ³rico

---

## 8) Rastreamento

### 8.1 LocalizaÃ§Ã£o do Entregador

| Campo         | DescriÃ§Ã£o |
| ------------- | --------- |
| entregador_id | Quem      |
| latitude      | Atual     |
| longitude     | Atual     |
| data_hora     | Timestamp |

---

## 9) Financeiro (opcional no MVP)

### 9.1 Pagamentos de Entregadores

| Campo         | DescriÃ§Ã£o      |
| ------------- | -------------- |
| entregador_id | Quem           |
| entrega_id    | ReferÃªncia     |
| valor         | ComissÃ£o       |
| status        | Pendente, Pago |
| metodo        | Pix            |

---

## 10) Auditoria e Logs

| Campo       | DescriÃ§Ã£o      |
| ----------- | -------------- |
| entidade    | Tipo           |
| entidade_id | ID             |
| acao        | CREATE, UPDATE |
| origem      | API, Sistema   |
| data_hora   | Timestamp      |

---

## 11) Fluxo Resumido (End-to-End)

1. Estabelecimento cria entrega
2. Sistema calcula distÃ¢ncia
3. Sistema precifica
4. Busca entregador prÃ³prio
5. Se nÃ£o houver â†’ integraÃ§Ã£o externa
6. Entregador aceita
7. Coleta â†’ rota â†’ entrega
8. Finaliza e registra histÃ³rico

---

## 12) EvoluÃ§Ã£o Natural do Produto

* MVP local (1 cidade)
* HÃ­brido (prÃ³prio + APIs)
* API pÃºblica para terceiros
* App do entregador
* PrecificaÃ§Ã£o dinÃ¢mica

---

## 13) Regra de Ouro

> **Construa primeiro o fluxo simples e observÃ¡vel.**
> OtimizaÃ§Ã£o vem depois.

Este modelo serve para vocÃª **pensar, ajustar e discutir** antes de codar.

## 14 PrÃ³ximo.

âœ… Passo a passo do produto

âœ… Modelo de entidades/tabelas

âœ… Perfis (estabelecimentos, entregadores, admin)

âœ… Fluxo de entrega ponta a ponta

âœ… PrecificaÃ§Ã£o

âœ… IntegraÃ§Ãµes externas (Uber Direct, Loggi, etc.)

âœ… EvoluÃ§Ã£o natural do MVP atÃ© SaaS

ğŸ“Œ Importante:
Esse material nÃ£o Ã© para codar agora, Ã© para:

refletir,

ajustar,

validar ideia,

enxergar complexidade real,

evitar retrabalho depois.

Como vocÃª pode usar esse material agora

SugestÃ£o prÃ¡tica:

Leia como se fosse um produto real

Pergunte:

â€œIsso resolve dor real?â€

â€œO que posso cortar no MVP?â€

Marque:

Essencial

Pode esperar

Nunca vou fazer

PrÃ³ximos passos (se quiser)

Posso ajudar vocÃª a:

ğŸ”¹ Reduzir isso para um MVP enxuto (10 tabelas ou menos)

ğŸ”¹ Desenhar API pÃºblica (endpoints, contratos)

ğŸ”¹ Pensar modelo de cobranÃ§a

ğŸ”¹ Separar o que Ã© core vs integraÃ§Ã£o

ğŸ”¹ Simular caso real: farmÃ¡cia de bairro
